- name: Add neovim apt repository
  when: ansible_os_family == 'Debian'
  become: true
  become_user: root
- name: Add neovim apt repository
  block:
    - name: Copy neovim.pgp
      ansible.builtin.copy:
        src: neovim.pgp
        dest: /etc/apt/keyrings/neovim.pgp
        owner: root
        group: root
        mode: '0755'

    - name: Add neovim.sources
      ansible.builtin.template:
        src: neovim.sources.jinja
        dest: /etc/apt/sources.list.d/neovim.sources
        owner: root
        group: root
        mode: '0644'

    - name: Run the equivalent of "apt-get update" as a separate step
      ansible.builtin.apt:
        update_cache: true

    - name: Install nvim
      tags: nvim
      ansible.builtin.apt:
        name:
          - neovim
        state: present
        update_cache: true
      become: true
      become_user: root

- name: Neovim on Arch
  when: ansible_os_family == 'Archlinux'
  block:
    - name: Install nvim
      kewlfft.aur.aur:
        name: neovim-git
        state: present
      become: true
      become_user: aur_builder


    - name: Pacman -Syy
      ansible.builtin.command: pacman -Syy
      become: true
      become_user: root

    - name: Install pynvim
      community.general.pacman:
        name: python-pynvim
        state: present
      become: true
      become_user: root

- name: Copy Neovim repo
  tags:
    - nvim
  block:
    - name: Copy nvim config
      ansible.builtin.copy:
        src: nvim
        dest: "{{ home }}/.config/"
        owner: "{{ user }}"
        group: "{{ user }}"
        mode: '0644'
      register: nvim
