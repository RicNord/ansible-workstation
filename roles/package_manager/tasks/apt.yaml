# Adding dependencies for installing apt keys
- name: Adding depencnecies
  tags:
    - debian
    - apt
  ansible.builtin.apt:
    pkg:
      - ca-certificates
      - curl
      - gnupg
      - lsb-release
      - wget
      - apt-transport-https

- name: Create /etc/apt/keyrings directory if it does not exist
  ansible.builtin.file:
    path: /etc/apt/keyrings
    state: directory
    owner: root
    group: root
    mode: '0755'

- name: Add post invoke script to delete automatically created sources.list files
  ansible.builtin.template:
    src: 100post-invoke
    dest: /etc/apt/apt.conf.d/100post-invoke
    owner: root
    group: root
    mode: '0644'

# Adding additional repositorys to APT
# Microsoft
- name: Add microsoft apt repository
  block:
    - name: Copy microsoft.pgp
      ansible.builtin.copy:
        src: microsoft.pgp
        dest: /etc/apt/keyrings/microsoft.pgp
        owner: root
        group: root
        mode: '0755'

    - name: Add azure-cli
      ansible.builtin.template:
        src: azure-cli.sources.jinja
        dest: /etc/apt/sources.list.d/azure-cli.sources
        owner: root
        group: root
        mode: '0644'

    - name: Add vscode
      ansible.builtin.template:
        src: vscode.sources.jinja
        dest: /etc/apt/sources.list.d/vscode.sources
        owner: root
        group: root
        mode: '0644'

## Google
- name: Add google apt repository
  block:
    - name: Copy google.pgp
      ansible.builtin.copy:
        src: google.pgp
        dest: /etc/apt/keyrings/google.pgp
        owner: root
        group: root
        mode: '0755'


    - name: Add google-chrome
      ansible.builtin.template:
        src: google-chrome.sources.jinja
        dest: /etc/apt/sources.list.d/google-chrome.sources
        owner: root
        group: root
        mode: '0644'

# Docker
- name: Add docker apt repository
  block:
    - name: Copy docker.pgp
      ansible.builtin.copy:
        src: docker.pgp
        dest: /etc/apt/keyrings/docker.pgp
        owner: root
        group: root
        mode: '0755'

    - name: Add docker
      ansible.builtin.template:
        src: docker.sources.jinja
        dest: /etc/apt/sources.list.d/docker.sources
        owner: root
        group: root
        mode: '0644'

# Hashicorp
- name: Add hashicorp apt repository
  block:
    - name: Copy hashicorp.pgp
      ansible.builtin.copy:
        src: hashicorp.pgp
        dest: /etc/apt/keyrings/hashicorp.pgp
        owner: root
        group: root
        mode: '0755'

    - name: Add hashicorp
      ansible.builtin.template:
        src: hashicorp.sources.jinja
        dest: /etc/apt/sources.list.d/hashicorp.sources
        owner: root
        group: root
        mode: '0644'

# Spotify
- name: Add spotify apt repository
  block:
    - name: Copy spotify.pgp
      ansible.builtin.copy:
        src: spotify.pgp
        dest: /etc/apt/keyrings/spotify.pgp
        owner: root
        group: root
        mode: '0755'

    - name: Add spotify
      ansible.builtin.template:
        src: spotify.sources.jinja
        dest: /etc/apt/sources.list.d/spotify.sources
        owner: root
        group: root
        mode: '0644'

# github
- name: Add github apt repository
  block:
    - name: Copy github.pgp
      ansible.builtin.copy:
        src: github.pgp
        dest: /etc/apt/keyrings/github.pgp
        owner: root
        group: root
        mode: '0755'

    - name: Add github-cli
      ansible.builtin.template:
        src: github-cli.sources.jinja
        dest: /etc/apt/sources.list.d/github-cli.sources
        owner: root
        group: root
        mode: '0644'

## Update and install packages
- name: Run the equivalent of "apt-get update" as a separate step
  ansible.builtin.apt:
    update_cache: true

- name: Install packages
  ansible.builtin.apt:
    pkg:
      - arandr
      - autorandr
      - azure-cli
      - bat
      - code
      - curl
      - dmenu
      - dunst
      - fd-find
      - filezilla
      - fzf
      - gdb
      - gimp
      - git
      - gh
      - libglib2.0-dev
      - gnupg
      - google-chrome-stable
      - gzip
      - htop
      - htop
      #      - incus # official in 24.04 (nobel)
      - jq
      - libnotify-dev
      - lxc
      - macchanger
      - maim
      - make
      - man-db
      - moreutils
      - ncdu
      - net-tools
      - nmap
      - npm
      #      - nsxiv # official in 24.04
      - openconnect
      - openssh-client
      - pandoc
      - parallel
      - pass
      - pulsemixer
      - python3-neovim
      - qbittorrent
      - ranger
      - redshift
      - ripgrep
      - rsync
      - sq
      - shellcheck
      - shfmt
      - slock
      - snapd
      - spotify-client
      - terraform
      #      - terragrunt # TODO Manual install
      - thefuck
      - tldr
      - tmux
      - torbrowser-launcher
      - traceroute
      - tree
      - unifont
      - unrar
      - unzip
      - vim-gtk3
      - virt-viewer
      - xclip
      - xsel
      - xsel
      - xterm
      - zathura
      - zathura-pdf-poppler
      - zip
    state: present
